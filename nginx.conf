# Configuração do Nginx do Game
# Serve os estáticos compilados do jogo (platform static) no Tsuru
# Apps: cartola-game-*
#
# **Não é um RPaaS**

worker_processes auto;
worker_rlimit_nofile 65000;

pid /var/lib/nginx/nginx.pid;
error_log stderr;

events {
  worker_connections 30000;
}

http {
  include mime.types;
  default_type text/html;

  sendfile on;
  server_tokens off;
  port_in_redirect off;
  large_client_header_buffers 4 16k;

  keepalive_timeout 10 10;
  client_header_timeout 30;
  client_body_timeout 30;
  send_timeout 30;
  reset_timedout_connection on;

  gzip              on;
  gzip_buffers      4 8k;
  gzip_comp_level   1;
  gzip_http_version 1.0;
  gzip_min_length   0;
  gzip_proxied      any;
  gzip_vary         on;

  # Additional types, "text/html" is always compressed:
  gzip_types  application/atom+xml application/javascript
              application/json application/rss+xml
              application/xml application/x-javascript
              text/css text/javascript text/plain text/xml
              image/svg+xml;

  access_log /dev/stdout;

  server {
    listen 8888 default_server;
    server_name localhost;
		port_in_redirect off;
    expires 60;

    location ~ ^/healthcheck(/?|\.html)$ {
      expires -1; # no-cache
      return 200 'WORKING\n';
    }

		location / {
			root  /home/application/current/dist;
			index index.html index.htm;
		}
  }
}
